#!/usr/bin/env bash
export DIR="$(cd "$(dirname "${BASH_SOURCE[0]}" )" && pwd)"
export PDIR="$(dirname $DIR)"
export IDIR="${PDIR}/tools/radamsa"
export URL=https://gitlab.com/akihe/radamsa

# NewPath .bashrc | .zshrc
appendPath() {
    BU_PATH=$HOME/$2
    backupFile "$BU_PATH"
    newPath="export PATH=$1:\${PATH}"
    grep -qF "$newPath" $BU_PATH || echo "$newPath" >> $BU_PATH
    source $BU_PATH 2>/dev/null
}

backupFile() {
    if [ ! -f $1.ORIGINAL ]; then
        cp $1 $1.ORIGINAL
    fi
}

installRadamsa() {
    rm -fr /tmp/radamsa "$IDIR"
    mkdir "$IDIR"
    git clone "$URL" /tmp/radamsa
    cd /tmp/radamsa
    make
    cp /tmp/radamsa/bin/radamsa "${IDIR}/radamsa"
    chmod +x "${IDIR}/radamsa"
    rm -fr /tmp/radamsa
    appendPath "$IDIR" ".bashrc"
    appendPath "$IDIR" ".zshrc"
    ${IDIR}/radamsa -h
}

installRadamsa